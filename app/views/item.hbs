{{#contentFor "stylesheets"}}
<style>
#newItem, #newItem:hover {
    text-decoration: none;
}
textarea {
    margin-bottom: 5px;
}
</style>
{{/contentFor}}

<section id="content">
    <form>
        <p><strong>Title</strong></p>
        <div class="form-group">
            <input class="form-control" type="text" placeholder="[title]" name="title">
        </div>
        <div class="form-group">
            <input class="form-control" type="text" placeholder="[subtitle]" name="subtitle">
        </div>

        <hr />
        <p><strong>Timeline</strong> <a id="newItem" href="#">+</a></p>

        <div class="list-group" id="timelineDatum"></div>

        <div class="form-group">
            {{!-- <input class="form-control" disabled="" type="text" placeholder="Wikipedia Link" alt="[citation needed]"> --}}
        </div>

        <hr/>

        <div class="form-group" style="text-align:right">
            <button class="btn btn-default" id="save">Save</button>
            <button class="btn btn-default" id="post">Publish</button>
        </div>
    </form>
</section>

{{#contentFor "scripts"}}
<script>
var timelineItem = '';
timelineItem += '<div class="charCount list-group-item-text" style="position:relative">';
timelineItem += '<textarea class="form-control" type="text" placeholder="Lorem ipsum dolor sit amet, consectetur adipisicing elit." maxlength="140" rows="2" style="resize: none;" name="timelineItem"></textarea>';
timelineItem += '<span class="count" style="position:absolute;right:5px;bottom:0px;color:#ccc">140</span>';
timelineItem += '</div>';

function spawnNewTimelineItem() {
    // console.log('should have spawned....')
    $('#timelineDatum').append(timelineItem);
}

spawnNewTimelineItem();

$("textarea[maxlength]").each(function() {
    var $this = $(this);
    var maxLength = parseInt($this.attr('maxlength'));
    $this.attr('maxlength', null);
    
    var el = $(".charCount>.count");
    
    $this.bind('keyup', function() {
        var cc = $this.val().length;
        
        el.text(maxLength - cc);
        
        if(maxLength < cc) {
            el.css('color', 'red');
        } else {
            el.css('color', '#ccc');
        }
    });
});

$("#newItem").click(function(e) {
    spawnNewTimelineItem();
});

$("#post").click(function(e) {
    console.log($('form'));
    var f = $('form').serialize();
    console.log(f);
    $.post('/api/new', f, function(r) {
        // console.log(r);
    });
});

</script>
{{/contentFor}}